@startuml 
title Programmer une consultation

actor "Professionnel de santé" as ProfSante
participant "ProfessionelUI" as UI
participant "PatientService" as PatientService
participant "ConsultationService" as ConsultService
participant "ProfessionnelSante" as ProfObj
participant "Patient" as PatientObj
participant "DossierMedical" as Dossier
participant "DataService" as DataService

== Sélection du patient ==
ProfSante -> UI : Demander programmation consultation
activate UI

UI --> ProfSante : Demande idPatient
ProfSante -> UI : Saisir idPatient

UI -> PatientService : findPatientById(idPatient)
activate PatientService
PatientService --> UI : patient ou null
deactivate PatientService

alt Patient trouvé
    UI --> ProfSante : Afficher infos patient\n+ demander date/heure/motif

    ProfSante -> UI : Saisir dateHeure, durée, motif

    ' Récupération du professionnel connecté
    UI -> ProfObj : (profesionnel courant)

    == Appel du service de consultation ==
    UI -> ConsultService : programmerConsultation(dateHeure, motif, ProfObj, PatientObj)
    activate ConsultService

    ' Dans le service : validations et disponibilités
    ConsultService -> ConsultService : vérifier paramètres\n+ date future\n+ motif non vide

    ConsultService -> ProfObj : estDisponiblePour(nouvelleConsultation)
    alt Professionnel disponible
        ConsultService -> PatientObj : getDossierMedical()
        activate PatientObj
        PatientObj --> ConsultService : dossierMedical
        deactivate PatientObj

        ConsultService -> Dossier : ajouterConsultation(nouvelleConsultation)
        ConsultService -> ProfObj : ajouterConsultation(nouvelleConsultation)
        ConsultService -> ConsultService : ajouter à la liste consultations

        ConsultService --> UI : true (succès)
        deactivate ConsultService

        ' Mise à jour durée et sauvegarde
        UI -> ConsultService : getConsultations()
        ConsultService --> UI : listeConsultations

        UI -> DataService : saveConsultations(listeConsultations)
        activate DataService
        DataService --> UI : sauvegardé
        deactivate DataService

        UI --> ProfSante : ✓ Consultation programmée
    else Non disponible ou invalide
        ConsultService --> UI : false (erreur/conflict)
        deactivate ConsultService
        UI --> ProfSante : ❌ Impossible de programmer\n(conflit ou erreur)
    end

else Patient introuvable
    UI --> ProfSante : ❌ Patient non trouvé
end

deactivate UI

@enduml
